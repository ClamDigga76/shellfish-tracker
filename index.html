<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Shellfish Harvest Tracker</title>
  <link rel="stylesheet" href="./styles.css" />
</head>

<body>
  <header class="app-header">
    <h1>Shellfish Harvest Tracker</h1>
    <div class="sub">Phase 3A • Review → Save • Local Storage • Totals • CSV</div>
  </header>

  <main class="app">
    <!-- GLOBAL STATUS / ERROR BANNER -->
    <section id="banner" class="banner hidden" role="status" aria-live="polite"></section>

    <!-- NAV -->
    <nav class="tabs" role="tablist" aria-label="Main navigation">
      <button class="tab active" data-tab="capture" role="tab" aria-selected="true">Capture</button>
      <button class="tab" data-tab="review" role="tab" aria-selected="false">Review</button>
      <button class="tab" data-tab="totals" role="tab" aria-selected="false">Totals</button>
      <button class="tab" data-tab="history" role="tab" aria-selected="false">History</button>
      <button class="tab" data-tab="export" role="tab" aria-selected="false">Export</button>
    </nav>

    <!-- CAPTURE -->
    <section id="tab-capture" class="panel active" role="tabpanel">
      <h2>Capture</h2>

      <div class="card">
        <div class="row">
          <label for="captureMode">Input mode</label>
          <select id="captureMode">
            <option value="manual" selected>Manual entry</option>
            <option value="ocr">OCR (paste text)</option>
          </select>
        </div>

        <!-- MANUAL ENTRY -->
        <div id="manualBox" class="stack">
          <div class="grid2">
            <div>
              <label for="m_date">Harvest date (MM/DD/YYYY)</label>
              <input id="m_date" inputmode="numeric" placeholder="12/11/2025" />
            </div>
            <div>
              <label for="m_dealer">Dealer</label>
              <input id="m_dealer" placeholder="Machias Bay Seafood" />
            </div>
          </div>

          <div class="grid2">
            <div>
              <label for="m_pounds">Pounds</label>
              <input id="m_pounds" inputmode="decimal" placeholder="43.5" />
            </div>
            <div>
              <label for="m_total">Total $</label>
              <input id="m_total" inputmode="decimal" placeholder="152.25" />
            </div>
          </div>

          <div class="row">
            <label for="m_notes">Notes (optional)</label>
            <input id="m_notes" placeholder="Any quick note…" />
          </div>

          <div class="actions">
            <button id="btnBuildReviewManual" class="primary">Build Review</button>
            <button id="btnClearManual" class="ghost">Clear</button>
          </div>
        </div>

        <!-- OCR PASTE -->
        <div id="ocrBox" class="stack hidden">
          <label for="ocrText">Paste OCR text here</label>
          <textarea id="ocrText" rows="8" placeholder="Paste OCR text from the check…"></textarea>

          <div class="actions">
            <button id="btnBuildReviewOCR" class="primary">Parse → Review</button>
            <button id="btnClearOCR" class="ghost">Clear</button>
          </div>

          <p class="hint">
            OCR parsing in Phase 3A is intentionally “best effort.” The safety is the Review screen.
          </p>
        </div>
      </div>
    </section>

    <!-- REVIEW -->
    <section id="tab-review" class="panel" role="tabpanel">
      <h2>Review & Confirm</h2>

      <div class="card">
        <p class="hint">
          Edit anything that looks off. Nothing saves until you hit <b>Confirm & Save</b>.
        </p>

        <div class="grid2">
          <div>
            <label for="r_date">Harvest date (MM/DD/YYYY)</label>
            <input id="r_date" inputmode="numeric" />
          </div>
          <div>
            <label for="r_dealer">Dealer</label>
            <input id="r_dealer" />
          </div>
        </div>

        <div class="grid2">
          <div>
            <label for="r_pounds">Pounds</label>
            <input id="r_pounds" inputmode="decimal" />
          </div>
          <div>
            <label for="r_total">Total $</label>
            <input id="r_total" inputmode="decimal" />
          </div>
        </div>

        <div class="row">
          <label for="r_notes">Notes (optional)</label>
          <input id="r_notes" />
        </div>

        <div class="row">
          <label for="r_raw">Raw source (optional)</label>
          <textarea id="r_raw" rows="5" placeholder="Stored for audit/debug…"></textarea>
        </div>

        <div class="actions">
          <button id="btnConfirmSave" class="primary">Confirm & Save</button>
          <button id="btnBackToCapture" class="ghost">Go Back</button>
        </div>
      </div>
    </section>

    <!-- TOTALS -->
    <section id="tab-totals" class="panel" role="tabpanel">
      <h2>Totals</h2>

      <div class="card">
        <div class="row">
          <label for="totalsRange">Range</label>
          <select id="totalsRange">
            <option value="7d">Last 7 days</option>
            <option value="mtd">Month-to-date</option>
            <option value="ytd" selected>Year-to-date</option>
          </select>
        </div>

        <div class="kpis">
          <div class="kpi"><div class="kpiLabel">Trips</div><div id="k_trips" class="kpiVal">0</div></div>
          <div class="kpi"><div class="kpiLabel">Total Pounds</div><div id="k_pounds" class="kpiVal">0</div></div>
          <div class="kpi"><div class="kpiLabel">Total $</div><div id="k_total" class="kpiVal">0</div></div>
          <div class="kpi"><div class="kpiLabel">Avg $/lb</div><div id="k_avg" class="kpiVal">0</div></div>
        </div>

        <div class="row">
          <button id="btnRefreshTotals" class="ghost">Refresh</button>
        </div>
      </div>
    </section>

    <!-- HISTORY -->
    <section id="tab-history" class="panel" role="tabpanel">
      <h2>History</h2>

      <div class="card">
        <div class="row">
          <label for="searchText">Search (dealer, notes, date)</label>
          <input id="searchText" placeholder="Type to filter…" />
        </div>

        <div id="historyList" class="list"></div>

        <div class="actions">
          <button id="btnDeleteAll" class="danger ghost">Delete ALL records</button>
        </div>
      </div>
    </section>

    <!-- EXPORT -->
    <section id="tab-export" class="panel" role="tabpanel">
      <h2>Export</h2>

      <div class="card">
        <p class="hint">Exports Excel-safe CSV. One row per trip.</p>
        <div class="actions">
          <button id="btnExportCSV" class="primary">Download CSV</button>
          <button id="btnCopyCSV" class="ghost">Copy CSV to clipboard</button>
        </div>
        <div class="row">
          <label for="csvPreview">Preview</label>
          <textarea id="csvPreview" rows="10" readonly></textarea>
        </div>
      </div>
    </section>

  </main>

  <footer class="footer">
    <div>Local-only storage • No cloud • Designed to stay stable on iPhone Safari</div>
  </footer>

  <!-- IMPORTANT: your repo uses /js. This must stay as ./js/app.js -->
  <script defer src="./js/app.js"></script>
</body>
</html>
